# Hel AQI Desktop Widget (Windows, Rainmeter)

<p align="center">
  <img src="hel-aqi-widget-win/blob/main/rainmeter/%40Resources/screenshot.png" width="600">
</p>

Small desktop widget for Windows that shows real-time air quality from nearby
[Sensor.Community](https://sensor.community/) sensors.  
The UI is built with **Rainmeter**, and data/graphs are generated by a small
**Python** script.

> ⚠️ All coordinates and sensor IDs in the repo are examples.  
> Replace them with your own locally and **do not commit your real home address**.

---

## Features

- Live **AQI** for two locations (e.g. “My home” and “Friend’s home”)
- Color-coded AQI scale (Good → Hazardous) with labels
- Trend arrows (going up, going down, flat)
- Separate 24-hour AQI history graphs for each location
- Last **PM2.5** and **PM10** values shown next to the graphs
- Semi-transparent Rainmeter skin that can be snapped to any corner of the screen
- Background Python daemon that updates data every few minutes

---

## How it works

1. **Python script (`aq_widget.py`)**
   - Fetches PM2.5 / PM10 data from Sensor.Community using their public API.
   - Calculates AQI based on US EPA breakpoints (PM2.5 + PM10).
   - Saves:
     - Current values into `@Resources/aqi_data.inc` for Rainmeter.
     - History into `@Resources/aqi_history.json`.
     - Graph images into `@Resources/aqi_graph_home.png` and `aqi_graph_vanya.png`.

2. **Background updater**
   - `update_aqi.bat` runs the Python script in a loop and refreshes Rainmeter:
     - logs to `aq_widget_log.txt`,
     - sleeps 300 seconds (5 minutes),
     - repeats.
   - `run_aq_daemon.vbs` starts the `.bat` file **hidden** so there is no console window.

3. **Rainmeter skins**
   - `Hel_AQI.ini` – main widget (two circles, color scale, labels).
   - `Hel_AQI_HomeGraph.ini` – 24-hour graph window for “home”.
   - `Hel_AQI_VanyaGraph.ini` – 24-hour graph window for “vanya”.
   - All skins read variables from `@Resources/aqi_data.inc`.

---

## Requirements

- Windows 10 / 11
- [Rainmeter](https://www.rainmeter.net/) 4.5 or newer
- Python 3.10+ (tested with 3.12)
- Python packages:
  - `requests`
  - `matplotlib`

Install the Python dependencies with:

```bash
pip install requests matplotlib
```
Installation

1) Install Rainmeter

Download and install Rainmeter from
https://www.rainmeter.net/

Clone or copy the skin

2) Clone this repository directly into your Rainmeter Skins folder:
```
C:\Users\<YourName>\Documents\Rainmeter\Skins\Hel_AQI
```
or create Hel_AQI there and copy the contents of this repo into it:
```
Documents\Rainmeter\Skins\Hel_AQI\
  Hel_AQI.ini
  Hel_AQI_HomeGraph.ini
  Hel_AQI_VanyaGraph.ini
  aq_widget.py
  update_aqi.bat
  run_aq_daemon.vbs
  @Resources\
      icons\
      (aqi_*.png / json files will be created automatically)
```
3) Configure your locations

Open aq_widget.py in any text editor and change the LOCATIONS block:
```
LOCATIONS = {
    "home": {
        "name": "My Home",
        "lat": 40.000000,
        "lon": 44.500000,
        "sensor_id": 12345,   # your Sensor.Community sensor id
    },
    "vanya": {
        "name": "Friend's Home",
        "lat": 40.200000,
        "lon": 44.500000,
        "sensor_id": 67890,
    },
}
```
   * lat / lon – approximate coordinates of the location (you can blur
them a little bit for privacy).

   * sensor_id – numeric ID of your Sensor.Community device
(you can get it from their map or API).

4) Fix paths in update_aqi.bat

Open update_aqi.bat and update the paths to match your system:
```
@echo off
cd /d "C:\path\to\your\Hel_AQI"

:loop
echo [LOOP %date% %time%] >> aq_widget_log.txt

"C:\Path\To\Python\python.exe" "C:\path\to\your\Hel_AQI\aq_widget.py" >> aq_widget_log.txt 2>&1

"C:\Program Files\Rainmeter\Rainmeter.exe" !RefreshApp >> aq_widget_log.txt 2>&1

timeout /t 300 /nobreak >nul
goto loop
```
   * cd /d – folder where aq_widget.py lives.
   * Python path – full path to your python.exe.
   * Adjust the timeout value if you want another update interval.

5) Fix paths in run_aq_daemon.vbs
```
Set WshShell = CreateObject("WScript.Shell")
WshShell.Run """C:\path\to\your\Hel_AQI\update_aqi.bat""", 0, False
```
   * Point it to the same location as your .bat file.

6) Start the background updater

Double-click run_aq_daemon.vbs.
It will start update_aqi.bat in the background and create a log file
aq_widget_log.txt in the same folder.

You can also add a shortcut to this .vbs file to the
Startup folder so it runs automatically on Windows login.

7) Load the skins in Rainmeter
   * Open Rainmeter (right-click tray icon → Manage).
   * On the Skins tab, find Hel_AQI.
   * Load:
         * Hel_AQI.ini (main widget),
         * Hel_AQI_HomeGraph.ini,
         * Hel_AQI_VanyaGraph.ini.

Click on the small circles to open the corresponding graph window.
Click on the graph window to go back to the main widget.

## Configuration

You can tweak several things:
   * Update interval – change the timeout value (in seconds) in update_aqi.bat.
   * History window size – change HOURS_HISTORY in aq_widget.py.
   * Colors / labels – edit the .ini files in Hel_AQI:
         * change fonts, colors, labels (“Good”, “Moderate”, etc.).
   * Radius for nearby sensors – change RADIUS_KM in aq_widget.py
if you want to search in a larger or smaller area around your coordinates.

File overview

   * Hel_AQI.ini – main Rainmeter skin with two circles + color AQI scale.
   * Hel_AQI_HomeGraph.ini – 24-hour AQI graph for the first location.
   * Hel_AQI_VanyaGraph.ini – 24-hour AQI graph for the second location.
   * aq_widget.py – Python script that:
         * fetches Sensor.Community data,
         * calculates AQI,
         * saves variables + history,
         * renders graph images with matplotlib.
   * update_aqi.bat – Windows batch loop that:
         * runs aq_widget.py,
         * refreshes Rainmeter,
         * sleeps and repeats.
   * run_aq_daemon.vbs – launches the batch file hidden (no console).
   * @Resources/aqi_data.inc – generated Rainmeter variables (AQI, PM2.5, PM10, colors, etc.).
   * @Resources/aqi_history.json – generated history for the last N hours.
   * @Resources/aqi_graph_home.png, aqi_graph_vanya.png – generated graph images.
   * @Resources/icons/ – arrow icons for AQI trends.

License

This project is currently shared without an explicit open-source license.
If you want other people to freely reuse and modify the code, consider adding
a LICENSE file (for example MIT)
and updating this section accordingly.
